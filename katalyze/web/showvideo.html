<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<body>
    <script type='text/javascript' src='jquery-1.6.1.js'></script>
    <script type='text/javascript' src="mpegts.js"></script>
    <table id="videoArea">
        <tr id="headerRow"></tr>
        <tr id="bottomRow"></tr>

    </table>

    <script>
    const urlSearchParams = new URLSearchParams(window.location.search);
    const params = Object.fromEntries(urlSearchParams.entries());
    const streamIds = params['streams'].split(',');


    var N = streamIds.length;

    $("#headerRow").html('<td colspan="'+ N +'"><video width="100%" id="videoElement0" playsinline muted controls ></video></td>');
    if (N > 1) {
      var bottomRow = $("#bottomRow");
      for (var i=1; i<N; i++) {
        var cell = $('<td><video width="100%" id="videoElement'+i+'" playsinline muted controls ></video></td>');
        bottomRow.append(cell);
      }
    }

    /*
    <table>
    	<tr>
	    <td colspan="2"><video width="100%" id="videoElement0"></video></td>
	</tr>
	<tr>
	    <td><video width="100%" id="videoElement1"></video></td>
	    <td><video width="100%" id="videoElement2"></video></td>
	</tr>
    </table>
*/

    
    if (mpegts.getFeatureList().mseLivePlayback) {
	    for (let index = 0; index < streamIds.length; index++) {
            const id = streamIds[index];
            var baseUrl = params['url'] ?? "";
            const streamURL = baseUrl + id;
            var videoElement = document.getElementById('videoElement' + index);
          
            videoElement.onclick = function() {
                if (streamIds[0] == id) {
                    // [id] is already a main screen, do nothing
                    return;
                }
                var rotatedStreams = streamIds;
                // we put [id] on the first place
                while (rotatedStreams[0] != id) {
                    rotatedStreams.push(rotatedStreams.shift());
                }     
                const newLink = location.protocol + '//' + location.host + location.pathname + "?url=" + params['url'] + "&streams=" + rotatedStreams.toString();
                window.location.href = newLink;
            }
          
            var player = mpegts.createPlayer({
	            type: 'm2ts',  // could also be mpegts, m2ts, flv
	            isLive: true,
	            url: streamURL
    	    });
	        player.attachMediaElement(videoElement);
	        player.load();
	        player.play();
	    }
    }
    
</script>
</body>



<style type="text/css" media="screen">
	table, th, td {
	  border: 1px solid black;
	}
</style>
</html>



