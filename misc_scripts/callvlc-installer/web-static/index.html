#!/bin/sh
set -e

# This script was created during WF 2019 to set up all the necessary settings
# to allow Firefox to open VLC from iCat and connect to a team webcam or
# desktop stream.

# Create script for starting VLC
sudo /bin/sh <<"EOF"
printf '%s\n' '#!/usr/bin/env bash
exec vlc ${1/vlc:\/\//http:\/\/}' > /usr/local/bin/callvlc
chmod +x /usr/local/bin/callvlc
EOF
cd -- ~/.mozilla/firefox/*.default/

# Create a Firefox handler for vlc://
umask 0077
printf '%s' '{"defaultHandlersVersion":{"en-US":4},"mimeTypes":{"application/pdf":{"action":3,"extensions":["pdf"]}},"schemes":{"ircs":{"action":2,"ask":true,"handlers":[null,{"name":"Mibbit","uriTemplate":"https://www.mibbit.com/?url=%s"}]},"mailto":{"action":2,"ask":true,"handlers":[null,{"name":"Yahoo! Mail","uriTemplate":"https://compose.mail.yahoo.com/?To=%s"},{"name":"Gmail","uriTemplate":"https://mail.google.com/mail/?extsrc=mailto&url=%s"}]},"irc":{"action":2,"ask":true,"handlers":[null,{"name":"Mibbit","uriTemplate":"https://www.mibbit.com/?url=%s"}]},"webcal":{"action":2,"ask":true,"handlers":[null,{"name":"30 Boxes","uriTemplate":"https://30boxes.com/external/widget?refer=ff&url=%s"}]},"vlc":{"action":2,"handlers":[{"name":"callvlc","path":"/usr/local/bin/callvlc"}]}}}' > handlers.json

# Create a vlc protocol
printf '%s\n' 'user_pref("network.protocol-handler.expose.vlc", false);' > user.js
